<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/app.css">
    <!-- fonts------------- -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Heebo:wght@100;200;300;400;500;600;700;800;900&family=Merriweather:wght@300;400;700;900&display=swap" rel="stylesheet">

    
    <title>E-commerce</title>
    <style>
      .navbar{
          padding: 15px 22px;
      }
      .navbar .navbar-brand{
          font-family: 'Merriweather', serif;
          font-weight: 700;
          letter-spacing: 1px;
      }
      .navbar .nav-link{
          text-transform: uppercase;
          letter-spacing: 1.5px;
          font-family: 'Heebo', sans-serif;
          
      }
      .navbar li{
          padding: 4px 16px;
      }
      .navbar .navbar-nav a{
          transition: transform 0.7s;
      }
      .navbar .navbar-nav a:hover{
          transform: translateY(-2px);
          
      }
      .landing-section .btn{
          margin-top: 25px;
          font-family: 'Heebo', sans-serif;
          font-size: 13px;
          padding: 10px 16px;
      }
      .landing-section{
          background: #070707;
          
      }
      .end-section{
          background: url('/img/guitar-end.jpg');
          color: white;
          background-position: center;
          min-height: 200px;
          margin-top: 80px;
          opacity: 0.85;
      }
      .end-section .content a{
          color: #606467;
          text-transform: lowercase;
          text-decoration: none;
      }
      .end-section .smj{
          color: #606467;
          line-height: 18px;
      }
      .end-section .content{
          padding-top: 60px;
      }
      .end-section .content h1{
          margin-bottom: 1px;
          text-transform: uppercase;
          font-family: 'Merriweather', sans-serif;
          font-size: 35px;
      }
      .end-section .content a i{
          padding: 10px 18px;
          font-size: 30px;
          /* color: #45474A; */
          /* color: whitesmoke; */
          color: #606467;
      }
      .animation2{
          animation: fade2 0.5s ease;
          transform-origin: center bottom;
      }
      @keyframes fade2{
        from{
            opacity: 0;
            transform: translateX(40px);
        }
        to{
            opacity: 1;
            transform: translateX(0px);
        }
    }
    </style>
</head>
<body>
<div class="container-fluid landing-section" > <!--Landing section starts here------------------->
    <header>
      <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #070707;">
        <a class="navbar-brand" href="/">J-SON GUITARS</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <% if(!currentUser){ %>
                <!-- if not logged in -->
                <li class="nav-item ">
                  <a class="nav-link" style=" color: white;" href="/register">Register <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" style=" color: white;" href="/login">Login</a>
                </li>
                <li class="nav-item">
                  <button data-toggle="modal" data-target="#cart" type="button" class="btn btn-outline-light" style="margin-top: 0;"><i class="fas fa-shopping-cart"></i> - <span class="total-count"></span></button>
                </li>
            <% } else { %>
                <!-- if logged in -->
                <li class="nav-item ">
                  <a class="nav-link" style=" color: white;" href="#">Hi <%= currentUser.username %>!</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" style=" color: white;" href="/logout">Logout</a>
                </li>
                <li class="nav-item">
                  <button data-toggle="modal" data-target="#cart" type="button" class="btn btn-outline-light" style="margin-top: 0;"><i class="fas fa-shopping-cart"></i> - <span class="total-count"></span></button>
                </li>
            <% } %>
            
          </ul>
        </div>
      </nav>
    </header>
  </div>

<div class="container" style="margin-top: 50px;">
    <!--Section: Block Content-->
<section class="mb-5">
  <a href="/all-products" class="btn btn-outline-secondary animation2" style="margin-bottom: 20px; margin-left: 4px;">GO BACK</a>
  <div class="row">
      
    <div class="col-md-6 mb-4 mb-md-0">

      <div id="mdb-lightbox-ui"></div>

      <div class="mdb-lightbox">

        <div class="row product-gallery mx-1">

          <div class="col-12 mb-0 p-0 animation2">
            <figure class="view overlay rounded z-depth-1 main-img">
                <img src="<%= product.img %>" class="img-fluid z-depth-1">
              
            </figure>
          </div>
          
        </div>

      </div>

    </div>
    <div class="col-md-6 animation2">

      <h5><%= product.name %></h5>
      <p><span class="mr-1"><strong><%= product.price %></strong></span></p>
      <p class="pt-1"><%= product.description %></p>
      
      <hr>
      
      
      <a type="button" data-name="<%= product.dataname %>" data-price="<%= product.dataprice %>" class="add-to-cart btn btn-info btn-md mr-1 mb-2"><i class="fas fa-shopping-cart pr-2 "></i>Add to cart</a>
    </div>
  </div>

</section>
<!--Section: Block Content-->
</div>



<!-- Modal -->
<div class="modal fade" id="cart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Cart</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="show-cart table"> <!--contains info of ordered items-->
          
        </table>
        <div>Total price: $<span class="total-cart"></span></div>
      </div>
      
      <div class="modal-footer">
          
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
        <a href="/ordered-items"><button type="button" class="btn btn-info" >Order now</button></a>
        <button class="clear-cart btn btn-danger" style="background-color: #DF5A4F;">Clear Cart</button>
      </div>
    </div>
  </div>
</div>
<!-- end section-------------------------------------- -->
<footer>
  <div class="container-fluid end-section">
      <div class="container content">
          <h1 class="text-center">
             J-SON GUITARS
          </h1>
          <p class="text-center">Â© All Righ Reserved.</p>
          <div class="text-center smj">Website designed by Sarthak.</div>
          <div class="text-center smj"><a  href="https://thecivildeveloper.com" target="_blank">https://thecivildeveloper.com</a></div>
          <div class="text-center follow">
              <a href="https://www.instagram.com/smj._.21?r=nametag" target="_blank"><i class="fab fa-instagram"></i></a>
              <a href="https://github.com/smj-21" target="_blank"><i class="fab fa-github" target="_blank"></i></a>
              <a href="https://www.linkedin.com/in/sarthak-316921200" target="_blank"><i class="fab fa-linkedin"></i></a>
          </div>
      </div>
      
  </div>
</footer>




<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
<script src="js/script.js"></script>
<script>
  // ************************************************
// Filter API
// ************************************************

// filter
$(document).ready(function(){
  $('.list').click(function(){
    const value = $(this).attr('data-filter');
    if(value == 'all'){
      $('.itemBox').show('1000');
    } 
    else{
      $('.itemBox').not('.'+value).hide('1000');
      $('.itemBox').filter('.'+value).show('1000');
    }
  });
});

// Add animation for filtering
$('.list').click(function(){
  $('.itemBox').addClass('animation2');
  
});
// active class
$('.list').click(function(){
  $(this).addClass('active').siblings().removeClass('active');
  
});



// ************************************************
// Shopping Cart API
// ************************************************

var shoppingCart = (function() {
  // =============================
  // Private methods and propeties
  // =============================
  cart = [];
  
  // Constructor
  function Item(name, price, count) {
    this.name = name;
    this.price = price;
    this.count = count;
  }
  
  // Save cart
  function saveCart() {
    sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
  }
  
    // Load cart
  function loadCart() {
    cart = JSON.parse(sessionStorage.getItem('shoppingCart'));
  }
  if (sessionStorage.getItem("shoppingCart") != null) {
    loadCart();
  }
  

  // =============================
  // Public methods and propeties
  // =============================
  var obj = {};
  
  // Add to cart
  obj.addItemToCart = function(name, price, count) {
    for(var item in cart) {
      if(cart[item].name === name) {
        cart[item].count ++;
        saveCart();
        return;
      }
    }
    var item = new Item(name, price, count);
    cart.push(item);
    saveCart();
  }
  // Set count from item
  obj.setCountForItem = function(name, count) {
    for(var i in cart) {
      if (cart[i].name === name) {
        cart[i].count = count;
        break;
      }
    }
  };
  // Remove item from cart
  obj.removeItemFromCart = function(name) {
      for(var item in cart) {
        if(cart[item].name === name) {
          cart[item].count --;
          if(cart[item].count === 0) {
            cart.splice(item, 1);
          }
          break;
        }
    }
    saveCart();
  }

  // Remove all items from cart
  obj.removeItemFromCartAll = function(name) {
    for(var item in cart) {
      if(cart[item].name === name) {
        cart.splice(item, 1);
        break;
      }
    }
    saveCart();
  }

  // Clear cart
  obj.clearCart = function() {
    cart = [];
    saveCart();
  }

  // Count cart 
  obj.totalCount = function() {
    var totalCount = 0;
    for(var item in cart) {
      totalCount += cart[item].count;
    }
    return totalCount;
  }

  // Total cart
  obj.totalCart = function() {
    var totalCart = 0;
    for(var item in cart) {
      totalCart += cart[item].price * cart[item].count;
    }
    return Number(totalCart.toFixed(2));
  }

  // List cart
  obj.listCart = function() {
    var cartCopy = [];
    for(i in cart) {
      item = cart[i];
      itemCopy = {};
      for(p in item) {
        itemCopy[p] = item[p];

      }
      itemCopy.total = Number(item.price * item.count).toFixed(2);
      cartCopy.push(itemCopy)
    }
    return cartCopy;
  }

  // cart : Array
  // Item : Object/Class
  // addItemToCart : Function
  // removeItemFromCart : Function
  // removeItemFromCartAll : Function
  // clearCart : Function
  // countCart : Function
  // totalCart : Function
  // listCart : Function
  // saveCart : Function
  // loadCart : Function
  return obj;
})();


// *****************************************
// Triggers / Events
// ***************************************** 
// Add item
$('.add-to-cart').click(function(event) {
  event.preventDefault();
  var name = $(this).data('name');
  var price = Number($(this).data('price'));
  shoppingCart.addItemToCart(name, price, 1);
  displayCart();
});

// Clear items
$('.clear-cart').click(function() {
  shoppingCart.clearCart();
  displayCart();
});

//to display cart at end
function displayCart() {
  var cartArray = shoppingCart.listCart();
  var output = "";
  for(var i in cartArray) {
    output += "<tr>"
      + "<td>" + cartArray[i].name + "</td>" 
      + "<td>(" + cartArray[i].price + ")</td>"
      + "<td><div class='input-group'><button  class='minus-item input-group-addon btn btn-primary' data-name=" + cartArray[i].name + ">-</button>"
      + "<input style='padding: 6px' type='number' class='item-count form-control' data-name='" + cartArray[i].name + "' value='" + cartArray[i].count + "'>"
      + "<button  class='plus-item btn btn-primary input-group-addon' data-name=" + cartArray[i].name + ">+</button></div></td>"
      + "<td><button class='delete-item btn btn-danger' data-name=" + cartArray[i].name + ">x</button></td>"
      + " = " 
      + "<td>" + cartArray[i].total + "</td>" 
      +  "</tr>";
  }
  $('.show-cart').html(output);
  $('.total-cart').html(shoppingCart.totalCart());    //displays total price
  $('.total-count').html(shoppingCart.totalCount()); //displayes cart number of items on navbar
}

//to display cart after checkout
function displayCart_after_checkout() {
    var cartArray = shoppingCart.listCart();
    var output = "";
    for(var i in cartArray) {
      output += "<tr>"
        + "<td>" + cartArray[i].name + "</td>" 
        + "<td>$ (" + cartArray[i].price + ")</td>"
        + "<td>items (" + cartArray[i].count + ")</td>"
        // + "<td><div class='input-group'><button class='minus-item input-group-addon btn btn-primary' data-name=" + cartArray[i].name + ">-</button>"
        // + "<input type='number' class='item-count form-control' data-name='" + cartArray[i].name + "' value='" + cartArray[i].count + "'>"
        // + "<button class='plus-item btn btn-primary input-group-addon' data-name=" + cartArray[i].name + ">+</button></div></td>"
        // + "<td><button class='delete-item btn btn-danger' data-name=" + cartArray[i].name + ">X</button></td>"
        // + " = " 
        + "<td> $" + cartArray[i].total + "</td>" 
        +  "</tr>";
    }
    
    $('.show-cart1').html(output);                      //show cart at checkout page
    $('.total-cart').html(shoppingCart.totalCart());    //displays total price
    $('.total-count').html(shoppingCart.totalCount()); //displayes cart number of items on navbar
  }



// Delete item button

$('.show-cart').on("click", ".delete-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCartAll(name);
  displayCart();
})


// -1
$('.show-cart').on("click", ".minus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.removeItemFromCart(name);
  displayCart();
})
// +1
$('.show-cart').on("click", ".plus-item", function(event) {
  var name = $(this).data('name')
  shoppingCart.addItemToCart(name);
  displayCart();
})

// Item count input
$('.show-cart').on("change", ".item-count", function(event) {
   var name = $(this).data('name');
   var count = Number($(this).val());
  shoppingCart.setCountForItem(name, count);
  displayCart();
});

displayCart();
displayCart_after_checkout(); //displays while checkout page

</script>
</body>
</html>